<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>水果通服务平台</title>
    <link href="css/easyui.css" rel="stylesheet" type="text/css"/> 
    <link href="css/oheng.css" rel="stylesheet" type="text/css" />   
     <style type="text/css">
#main {
    margin: 0 10px 0 180px;
    /* height:1000px; */
    position: fixed;
}
.ycyyBtnSelect .ell{width: 100px;line-height: 25px;vertical-align: top;}

#left {
    width: 180px;
    /* height:1000px; */
    /* float:left; */
}

#right {
    width: 6px
}

#left {
    /* float: left; */
    position:absolute;
    left:10px;
    top: 16px;
    bottom: 16px;
    position: fixed;-webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Chrome/Safari/Opera */
    -khtml-user-select: none;
    /* Konqueror */
    -moz-user-select: none;
    /* Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    overflow: auto;
}

#right {
    float: right
}

#warningContainer {
    /* position: absolute; */
    /* left: 10px; */
    /* right: 0; */
    font-size: 12px;
    /* top: 0; */
    /* bottom: 0; */
    /* height:12200px; */
    /* width: 150px; */
    /* overflow: auto; */
}

.datagrid-cell input[type=checkbox] {
    position: absolute !important;
    clip: rect(0, 0, 0, 0) !important;
    /* IE8+ */
    *left: -999px !important;
}

.expandCls {
    left: 20px !important;
    transition: 0.5s all;
}

.gridBodyClsWithTitle,
.gridTitleCls {
    transition: 0.5s all;
}
.menuTopTitle
{   font-weight:bold;
    color:#3f73ae;
 }
.easyui-dialog .gridBodyClsWithTitle {
    overflow: hidden !important;
    border: 1px solid #eee;
    box-sizing: border-box;
}


#left.showExpand {
    width: 60px !important;
}

#left.showExpand #warningContainer {
    display: none;
}

.gridBodyClsWithTitle .datagrid-view2 .datagrid-header,
.gridBodyClsWithTitle .datagrid-view2 .datagrid-body {
    width: 100% !important;
}

.datagrid-body .datagrid-editable {
    margin: 0 8px;
}

.zbDateInput,
.ycyycancle,
.zbrInput {
    border: 0 !important;
    cursor: pointer;
    background: transparent;
    width: 80px !important;
    margin-left: -6px !important;
}

.yccancle,
.wxsend {
    cursor: pointer;
    height: 16px;
    width: 16px !important;
    padding: 0 !important;
}

.datagrid-view {
    width: 100% !important;
}
.gridTitleCls
{
    border: 1px solid #ddd;
    width:  auto!important;
    position: absolute!Important;
    left: 16px;
    right:0;
    top: 0px;
}

.menuSection ul {
    display: none;
}

.showOr .subMenu{
    display: block !important;
}
.subMenu{
    display: none !important;
}
.datagrid-view2 {
    width: 100% !important
}

.ycyyBtnSelect {
    color: red;
    position: relative;
}#btnEffect{
    font-family: monospace;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 21px;
    position: absolute;
    color: #888;
    padding-left:30px;
    left:-46px;
    top: 0px;
    width: auto;
    text-indent: 0;
    z-index: 1;
    width: 30px;
    text-align: left;
    }
#main{position: absolute;top: 16px;bottom: 16px;left: 0;right: 0;}
.showExpand #main{margin-left:40px;}
.showExpand .left{display:none;}
.showExpand .right{display:block;}
.showExpand #left{margin-left:-11140px;}#center .gridBodyClsWithTitle {right:0;bottom:0;}
    </style>

  </head>
  <body>
    <!---菜单-->
    <div id="left">
        <div id="warningContainer"></div>    </div>

    <div id="main">    

    
       
        <a id="btnEffect" href="javascript:void(0);"><span class="left">&lt;&lt;</span><span class="right">&gt;&gt;</span> </a>
        <div id="center">
            <!---表格 -->
            <table id="tableDataGrid"></table>
        </div>
 
    </div>
           <div id="right"></div>
           <div class="fix" id="topList">
                <form id="ohForm" class="mt2em">
                    <div class="inline_block mr1em mb1em">
                        <a id="helpDocument" href="/Help.aspx" target="_blank" class="form_a">
                            <i class="icon-help icon_"></i>
                            <span class="mrHalfem">帮助文档</span></a>
                    </div>
                    <div class="inline_block mr1em mb1em">
                        <label class="mrHalfem">业务编号</label>
                        <input name="ywbh" class="ui-input w100" />
                    </div>
                    <div class="inline_block mr1em mb1em">
                        <label class="mrHalfem">人员</label>
                        <input class="ui-input w100" name="ry" />
                    </div>
                    <div class="inline_block mr1em mb1em">
                        <label class="mrHalfem">预警内容</label>
                        <input class="ui-input w100" name="yjnr" />
                    </div>
                    <div class="inline_block mr1em mb1em">
                        <label class="mrHalfem">接单人</label>
                        <select class="ui-input w200" name="jdrjc" id="jdrjc"></select>
                    </div>
                    <div class="inline_block mr1em mb1em">
                        <label class="mrHalfem">是否勾选</label>
                        <select class="easyui-combobox ui-input" name="sfgx" style="width:100px;" data-options="panelWidth:100,panelHeight:190">
                            <option value="">全部</option>
                            <option value="Y">已勾选</option>
                            <option value="N">未勾选</option>
                        </select>
                    </div>
                    <div class="inline_block mr1em  mb1em">
                        <a id="ycyy" class="ui-button  ui-button-primary" role="button">异常原因</a>
                    </div>
                    <div class="inline_block mr1em  mb1em">
                        <a id="filterFunc" class="ui-button ui-button-primary">查询</a>
                    </div>
                </form>
            </div>
    <!--region  确认关闭弹窗 --->
    <div class="hide" id="confirmDialog"></div>
    <!--end region  确认关闭弹窗 --->

    <!--region  工具按钮 --->
    <div id="ycyyToolbar" class="hide toolbar-cls">
        <a href="javascript:void(0)" class="easyui-linkbutton btn-cell" iconcls="icon-save" plain="true" id="saveData">存盘</a>
        <span class="btn-cell">|</span>

        <a href="javascript:void(0)" class="easyui-linkbutton  btn-cell" iconcls="icon-add" plain="true" id="addRow">新增</a>
        <span class="btn-cell">|</span>

        <a href="javascript:void(0)" class="easyui-linkbutton btn-cell" iconcls="icon-undo" plain="true" id="cancle">撤销</a>
        <span class="btn-cell">|</span>
        <a href="javascript:void(0)" class="easyui-linkbutton btn-cell" iconcls="icon-remove" plain="true" id="closeDialog">关闭</a>
    </div>
    <!--region  工具按钮--->

    <!--region  输入异常原因对话框 弹窗--->
    <div id="ycyyInputTable" class="easyui-dialog" title="输入异常原因" data-options="closed:true">
        <table id="yjlxTableDataGrid"></table>
    </div>
    <!--region  输入异常原因对话框 弹窗--->
    <div id="ycyySelectList" title="异常类型下拉选择" class="easyui-dialog" data-options="closed:true,border:false,cls:'Cls',height:200,width:400">
        <table id="yjlxListDataGrid"></table>
    </div>

        <!--end  region  输入异常原因对话框 弹窗--->
    <div class="ui-loading fix-loading" style="height:100px;"><span class="ui-loading-icon"> </span> </div>



     <script type="text/javascript" src="Scripts/JQuery-1.6.min.js"></script>
    <script type="text/javascript" src="Scripts/jqueryAndeasyuiAndjson.js"></script>
<script type="text/javascript">
    var main = {
        yjxxMenuData: [],
        ycyyAddData: {}
    };


    $(".ui-loading").loading();
  
        $.ajaxSetup({
            dataType: 'json',
            contentType: "application/json;charset=utf-8"
        });


        
        var baseUrl = "/IFView/IndexHandler.ashx";
        var ajaxPost = function (url, data, success, error) {
            $.ajax({
                type: "Get",
                url: url,
                data: data,
                dataType: 'json',
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (success) {
                        success(data);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    if (!error) {
                        return false;
                    }
                    error({
                        jqXHR: jqXHR,
                        textStatus: textStatus,
                        errorThrown: errorThrown
                    });
                }
            });
        };


        /**************************menu**************************/
        var $menuContainer = $("#warningContainer");
        var $gridDiv = $("#tableDataGrid");
        var formatData = function (dataArr, index) {
            //对后台传过来的数据进行修造
            var origin = dataArr && dataArr.rows;
            if (!(origin && origin.length)) {
                return false;
            }
            var menuItems = [];
            $.each(origin, function (i) {
                menuItems.push({
                    yjlxmc: origin[i].yjlxmc ? $.trim(origin[i].yjlxmc) : "",
                    yjlxbh: origin[i].yjlxbh ? origin[i].yjlxbh : "",
                    IsLast: origin[i].IsLast ? origin[i].IsLast : "",
                    syjbh: origin[i].syjbh ? origin[i].syjbh : "",
                    xh: origin[i].xh ? origin[i].xh : "",
                    parentIndex: index ? index : "",
                    menuData: [],
                    selfIndex: i
                });
            });
            return menuItems;
        };

        // 第一次 初始化菜单       参数设置

        var menuParams = { action: "GetWarningMenuList", parentId: "00" }; // 请求参数
        var menuHandler = function (initData) {
            // 处理函数

            $menuContainer.data("data", initData);
            var menuItems = (main.yjxxMenuData = formatData(initData));

            if (!menuItems && menuItems[0]) {
                return false;
            }

            var strhtml = "";
            var tophtml = "";
            for (var iItem = 0; iItem < menuItems.length; iItem++) {
                var item = menuItems[iItem];
                if (item && item.yjlxbh && item.yjlxbh === "00") {
                    tophtml = '<div data-syjbh="' + item.syjbh + '"   class="menuTopTitle menuListTitle" data-id="' + item.yjlxbh + '"    id="' +
              item.yjlxbh + '">' + item.yjlxmc + '</div> ';
                } else {
                    strhtml += '<div class="menuSection"> <div class="menuListTitle"  data-syjbh="' + item.syjbh + '"  data-id="' + item.yjlxbh + '"  >' + item.yjlxmc + '</div> <div data-syjbh="' + item.syjbh + '"   class="hide subMenu"    data-id="' + item.yjlxbh + '"  id="' + item.yjlxbh + '"  ></div></div>';
                }
            }

            $("#warningContainer").html(tophtml + strhtml);
            //  初次加载全部数据
            $(".menuTopTitle").addClass("activeMenuListTitle");
        };
        //  第一次 初始化菜单  发起请求
        ajaxPost(baseUrl, menuParams, menuHandler);

        // 接单人请求
        $("#jdrjc").combobox({
            url: baseUrl + "?action=GetJdrData",
            valueField: "khjc",
            panelWidth: 160, method: "Get",
            panelHeight: 200,
            textField: "khjc",
            loadFilter: function (data) {
                data.rows.unshift({ khjc: "全部" });
                return data.rows;
            }
        });
        $("#jdrjc").combobox("setValue", "全部");

        // 给一级菜单绑定 点击事件
        $(document).delegate(".menuListTitle", "click", function (e) {
            var $this = $(this);
            $(".menuListTitle").removeClass("activeMenuListTitle");
            $this.toggleClass("activeMenuListTitle");

            if ($this.attr("id") === "00") {
                //全部 菜单触发

                $(".ui-loading").loading();
                // 初始化datagrid
                $.getJSON("/IFView/IndexHandler.ashx?action=GetTableData&yjlxbm=00&page=1&&rows=200", function (data) {

                    var dataArr = new Array();
                    dataArr = data.rows;

                    var dataJson = { "total": data.total, "rows": dataArr };
                    $gridDiv.datagrid("loadData", dataJson);
                    $(".ui-loading").fadeOut();
                });

                return false;
            }
            $this.parent().toggleClass("showOr");
            if ($this.data("data")) {
                // 判断是否请求过数据  //已经初始化
                console.log($this.data("data"));
                console.log("已经初始化");
                return false;
            }

            //未初始化发起，ajax 请求，渲染二级菜单
            var $thisParent = $this.parent();
            var index = $thisParent.index() - 1;

            var id = $this.attr("data-id");
            if (!id) {
                $.messager.alert("提示", "系统出错：" + errorMsg);
            }

            var subMenuParms = {
                action: "GetWarningMenuList",
                parentId: id
            };

            var subMenuHandler = function (menuData) {
                $this.data("data", menuData);
                //防止多次请求     初始化数据 次级菜单
                main.yjxxMenuData[index].menuData = formatData(menuData, index);

                main.yjxxMenuData[index].hasInit = true; // 初始化
                // 将求得的二级菜单数据变为html
                var subData = main.yjxxMenuData[index].menuData;
                /***** 生成子菜单 ********/
                if (!subData && !subData.length) {
                    return false;
                }
                var submenuHtml = "";

                $.each(subData, function (i, item) {
                    submenuHtml +=
              '<div  data-syjbh="' + item.syjbh + '"   data-id="' + item.yjlxbh + '" id="' + item.yjlxbh + '"   class="' + item.syjbh +
              ' theLastItem"   >' + item.yjlxmc + "</div>";
                });
                var $subObj = $("#" + subData[0]["syjbh"]);
                $subObj.html(submenuHtml);
                $(document).delegate(".theLastItem", "click", function (e) {
                    var $taerget = $(e.currentTarget);
                    $(".activeTheLastItem").removeClass("activeTheLastItem");
                    $taerget.addClass("activeTheLastItem");
                    var yjlxbm = $.trim($taerget.attr("id"));
                    $(".ui-loading").loading();
                    // 初始化datagrid
                    $.getJSON("/IFView/IndexHandler.ashx?action=GetTableData&yjlxbm=" + yjlxbm + "&page=1&&rows=200", function (data) {

                        var dataArr = new Array();
                        dataArr = data.rows;

                        var dataJson = { "total": data.total, "rows": dataArr };
                        $gridDiv.datagrid("loadData", dataJson);
                        $(".ui-loading").fadeOut();
                    });

                });
            };
            //  点击一级菜单  发起请求
            ajaxPost(baseUrl, subMenuParms, subMenuHandler);
        });


        /***********************end***menu**************************/

        // 初始化datagrid    参数设置
        var gridDivOptions = {};

        var $ycListDialog = $("#ycyySelectList");
        var $ycTableDialog = $("#ycyyInputTable");

        $("#yjlxTableDataGrid").edatagrid({
            nowrap: true,
            rownumbers: false,
            resizable: true,
            striped: true,
            data: { "total": 0, "rows": [] },
            headerCls: "gridTitleCls",
            bodyCls: "gridBodyClsWithTitle",
            singleSelect: true,
            halign: "center",
            border: false,
            height: 500,
            editing: false,
            ediIndex: -1,
            data: { "total": 20, "rows": [] },
            showFooter: false,
            border: true,
            width: "100%",
            toolbar: "#ycyyToolbar",
            columns: [
                    [{
                        sortable: false,
                        field: "rownumber",
                        title: "序号",
                        align: "center",
                        width: 40, formatter: function (value, row, index) {
                            return index + 1;
                        }
                    },
                      {
                          sortable: false,
                          field: "isNew",
                          title: "isNew",
                          width: 0,
                          hidden: true
                      },
                      {
                          sortable: false,
                          field: "yjlxbm",
                          title: "预警类型编码",
                          width: 0,
                          hidden: true
                      },
                      {
                          sortable: false,
                          field: "id",
                          title: "id",
                          width: 0,
                          hidden: true
                      },
                      {
                          sortable: false,
                          field: "zbr",
                          title: "制表人",
                          width: 50,
                          editor: {
                              type: "text",
                              options: { required: true }
                          }
                      },
                      {
                          sortable: false,
                          field: "ycyymc",
                          title: "异常原因",
                          width: 120,
                          formatter: function (value, row, index) {

                              if (row.isNewRecord) {
                                  var str = "";
                                  if (!value) {
                                      str = "请选择异常类型";
                                  } else {
                                      str = value;
                                  }
                                  return (
                              "<div class='relative ycyyBtnSelect cursor important'><span  class='ell' title=" +
                              value +
                              " >" +
                              str +
                              "</span><i class='ui-select-icon'></i></div>"
                            );
                              } else {
                                  return (
                              "<span class='ycCls' title=" +
                              value +
                              " >" +
                              value +
                              "</span>"
                            );
                              }
                          }




                      },
                      {
                          sortable: false,
                          field: "zbrq",
                          title: "制表日期",
                          width: 80,
                          editor: {
                              type: "text",
                              options: { required: true, readonly: true }
                          }
                      },
                      {
                          sortable: false,
                          field: "beizhu",
                          title: "备注",
                          width: 180,
                          editor: {
                              type: "text",
                              options: { required: true }
                          },
                          formatter: function (value, row, index) {
                              if (!row.id && value === "") {
                                  // 没id,新增
                                  return '<input class="ui-input beizhu" name="beizhu"  focus />';
                              }
                              return value;
                          }
                      },
                      {
                          sortable: false,
                          field: "ycyyqc",
                          title: "异常原因取消",
                          width: 80,
                          formatter: function (value, row, index) {
                              if (!value) {
                                  value = "N";
                              }

                              var temAttr = value === "N" ? "" : "checked ";
                              return (
                            '<input disabled type="checkbox"  ' +
                            temAttr +
                            ' id="sfgx_checkbox' +
                            index +
                            '"  name="checkbox"> <label for="sfgx_checkbox' +
                            index +
                            '"  class="ui-checkbox"></label><label for="sfgx_checkbox' +
                            index +
                            '" ></label>'
                          );
                          }
                      },
                      {
                          sortable: false,
                          field: "ycyyqcsj",
                          title: "异常原因取消时间",
                          width: 80,
                          formatter: function (value, row, index) {
                              if (!value || value == "1900/1/1 0:00:00") {
                                  value = "";
                              }
                              return '<span class="ycyyqcsjSpan">' + value + "</span>";
                          }
                      },
                      {
                          field: "wxsffs",
                          title: "微信是否发送",
                          width: 80,

                          formatter: function (value, row, index) {
                              if (!value) {
                                  value = "N";
                              }
                              var temAttr = value === "N" ? "" : "checked ";
                              return (
                            '<input disabled type="checkbox"  ' +
                            temAttr +
                            ' id="sfgx_checkbox' +
                            index +
                            '"  name="checkbox"> <label for="sfgx_checkbox' +
                            index +
                            '"  class="ui-checkbox"></label><label for="sfgx_checkbox' +
                            index +
                            '" ></label>'
                          );
                          }
                      }]],
            onClickRow: function (rowIndex, rowData) {
            },
            onClickCell: function (rowIndex, field, value) {

                if ($("#yjlxTableDataGrid").edatagrid("options").editIndex != rowIndex) {
                    $("#yjlxTableDataGrid").edatagrid("disableEditing");
                    return false;
                }
                $("#yjlxTableDataGrid").edatagrid("enableEditing");


                if (field == "ycyyqc") {
                    if (!value) {
                        value = "N";
                    }
                    value = value == "N" ? "Y" : "N";
                    if (value == "Y") {
                        main.ycyyAddData.ycyyqcsj = getTime();
                    } else {
                        main.ycyyAddData.ycyyqcsj = "";
                    }
                    main.ycyyAddData.ycyyqc = value;
                    $(".ycyyqcsjSpan")
                        .eq(rowIndex)
                        .html(main.ycyyAddData.ycyyqcsj);
                }

                if (field == "wxsffs") {
                    if (!value) {
                        value = "N";
                    }

                    value = value == "N" ? "Y" : "N";
                    main.ycyyAddData.wxsffs = value;
                }

                $("#yjlxTableDataGrid").edatagrid("updateRow", {
                    index: rowIndex,
                    row: main.ycyyAddData
                });
            },
            onSelect: function (rowIndex, rowData) {
                //回写数据到 异常原因 表格

                if ($("#yjlxTableDataGrid").edatagrid("options").editIndex == rowIndex) {
                    main.ycyyAddData.sfwx =
                      rowData.sfwx || rowData.sfwx == "N" ? "N" : "Y";
                    main.ycyyAddData.ycyymc = rowData.ycyymc;
                    main.ycyyAddData.ycyybm = rowData.ycyybm;

                    $("#yjlxTableDataGrid").edatagrid("updateRow", {
                        index: $("#yjlxTableDataGrid").edatagrid("options").editIndex,
                        row: {
                            ycyymc: rowData.ycyymc
                        }
                    });

                    $("#ycyySelectList").dialog("close");
                }
             
            }

        });


        $("#yjlxListDataGrid").edatagrid({
            nowrap: true,
            rownumbers: false,
            resizable: true,
            striped: true,
            data: { "total": 0, "rows": [] },
            headerCls: "gridTitleCls",
            bodyCls: "gridBodyClsWithTitle",
            singleSelect: true,
            halign: "center",
            border: false,
            height: 200,
            title: "",
            width: 400,
            columns: [
                    [{
                        sortable: false,
                        field: "rownumber",
                        title: "序号",
                        align: "center",
                        width: 40, formatter: function (value, row, index) {
                            return index + 1;
                        }
                    },
                      {
                          sortable: false,
                          field: "ycyybm",
                          title: "编码",
                          width: 50
                      },
                      {
                          sortable: false,
                          field: "ycyymc",
                          title: "异常原因名称",
                          width: 160,
                          formatter: function (value, row, index) {
                              return '<span title="' + value + '">' + value + "</span>";
                          }
                      },
                      {
                          sortable: false,
                          field: "ycyylb",
                          title: "异常原因类别",
                          width: 80
                      }
                    ]
                  ],
            // queryParams: {
            // yjlxbh: yjlxbh ? yjlxbh : "",
            //  action: "GetYcyyListData"
            // },
            onSelect: function (rowIndex, rowData) {
                //回写数据到 异常原因 表格

                main.ycyyAddData.sfwx =
                      rowData.sfwx || rowData.sfwx == "N" ? "N" : "Y";
                main.ycyyAddData.ycyymc = rowData.ycyymc;
                main.ycyyAddData.ycyybm = rowData.ycyybm;

                $("#yjlxTableDataGrid").edatagrid("updateRow", {
                    index: $("#yjlxTableDataGrid").edatagrid("options").editIndex,
                    row: {
                        ycyymc: rowData.ycyymc
                    }
                });

                $("#ycyySelectList").dialog("close");
            }

        });





        var getTime = function () {
            var time =
                    new Date().getFullYear() +
                    "/" +
                    (new Date().getMonth() + 1) +
                    "/" +
                    new Date().getDate() +
                    " " +
                    new Date().getHours() +
                    ":" +
                    new Date().getMinutes() +
                    ":" +
                    new Date().getSeconds();
            return time;
        };
        // 初始化 dialog


        $ycTableDialog.dialog({
            height: 300,
            top: 30,
            cls: "dialogCls",
            width: 600,
            resizable: true,
            modal: true,
            closed: true,
            minimizable: true,
            collapsible: true,
            minimizable: true,
            maxmizable: true,
            draggable: true,
            onClose: function () {
                $gridDiv.datagrid("uncheckAll").datagrid("unselectAll");
            }
        });

        $ycListDialog.dialog({
        height: 246,
        width: 400,
        top: 30,
        closed: true,
        resizable: true,
        draggable: true
    });




        $gridDiv.datagrid({ toolbar: "#topList", title: "预警信息查询",
            headerCls: "gridTitleCls  left160",
            bodyCls: "gridBodyClsWithTitle left160",
            method: "get", loading: "正在加载数据，请稍候......",
            columns: [[
            {
                sortable: false,
                checkbox: true,
                field: "yj1xbm",
                width: 20,
                title: "预警类型编码"
            },
            {
                sortable: false,
                field: "rownumber",
                title: "序号",
                align: "center",
                width: 40
            }, {
                sortable: false,
                field: "ry",
                width: 0,
                title: "用户名",
                hidden: true
            },
            {
                sortable: false,
                field: "xh",
                width: 0,
                title: "序号",
                hidden: true
            },
            {
                sortable: false,
                field: "sfhys",
                width: 0,
                title: "是否是红颜色",
                hidden: true
            },

            {
                sortable: false,
                field: "yjlxmc",
                width: 80,
                title: "预警类型"
            },
            {
                sortable: false,
                field: "ywbh",
                width: 80,
                title: "编号"
            },
            {
                sortable: false,
                field: "hth",
                title: "合同号"
            },
            {
                sortable: false,
                field: "yjsj",
                title: "预警时间"
            },
            {
                sortable: false,
                field: "jsq",
                width: 80,
                title: "计时器"
            },
            {
                sortable: false,
                field: "rymc",
                width: 50,
                title: "人员"
            },
            {
                sortable: false,
                field: "yjnr",
                title: "预警内容"
            },
            {
                sortable: false,
                field: "ycd",
                width: 80,
                title: "原产地",
                align: "center"
            },
            {
                sortable: false,
                field: "sp",
                width: 80,
                title: "商品",
                align: "center"
            },
            {
                sortable: false,
                field: "xq",
                width: 80,
                title: "详情",
                align: "center"
            },
            {
                sortable: false,
                field: "qzyj",
                width: 80,
                title: "前置预警"
            },
            {
                sortable: false,
                field: "jdrjc",
                width: 100,
                title: "接单人"
            },
            {
                sortable: false,
                field: "sfyycyy",
                width: 100,
                title: "是否有异常原因",
                align: "center",
                formatter: function (value, row, index) {
                    var temAttr = value === "N" ? "" : "checked ";
                    return (
                  '<input disabled type="checkbox"  ' +
                  temAttr +
                  ' id="checkbox' +
                  index +
                  '"  name= "checkbox"> <label for="checkbox' +
                  index +
                  '"  class="ui-checkbox"></label><label for="checkbox' +
                  index +
                  '" ></label>'
                );
                }
            }, {
                field: "sfgx",
                width: 80,
                title: "是否勾选",
                align: "center",
                formatter: function (value, row, index) {
                    var temAttr = value === "N" ? "" : "checked ";
                    return '<input disabled type="checkbox"  ' +
                  temAttr +
                  ' id="sfgx_checkbox' +
                  index +
                  '"  name="checkbox"> <label for="sfgx_checkbox' +
                  index +
                  '"  class="ui-checkbox"></label><label for="sfgx_checkbox' +
                  index + '" ></label>';
                }
            }]], idField: "rownumber",
            dataType: "json",
            nowrap: true,
            fit: true,
            rownumbers: false,
            singleSelect: true,
            border: false,
            data: { "total": 200, "rows": [] },
            resizable: true,
            striped: true,
            width: "100%",
            height: "600",
            pagination: true,
            pageNumber: 1, pageSize: 200,
            pageList: [200, 400, 600, 800, 1000],
            onSelect: function (rowIndex, row) {
                main.ycyyAddData.yjlxbm = row.yjlxbm;
                main.ycyyAddData.ywbh = row.ywbh;

                $.getJSON("/IFView/IndexHandler.ashx?action=GetYcyyTableData&yjlxbh=" + row.yjlxbm + "&ywbh=" + row.ywbh, function (data) {
                    if (data.rows && data.rows.length) {

                        var dataArr = new Array();
                        dataArr = data.rows;
                        var dataJson = { "total": data.total, "rows": dataArr };
                        $("#yjlxTableDataGrid").edatagrid("loadData", dataJson);
                    }

                });



                $.getJSON("/IFView/IndexHandler.ashx?action=GetYcyyListData&yjlxbh=" + row.yjlxbm, function (data) {
                    if (data.rows && data.rows.length) {

                        var dataArr = new Array();
                        dataArr = data.rows;
                        var dataJson = { "total": data.total, "rows": dataArr };
                        $("#yjlxListDataGrid").edatagrid("loadData", dataJson);
                    }

                });


            },
            rowStyler: function (index, row) {
                if (row.sfhys == '0') {
                    return 'color:#ff00ff;';
                }
                if (row.sfhys == '1') {
                    return 'color:#f76ef7;';
                }
                if (row.sfhys == '2') {
                    return 'color:#0000ff;';
                }
            }
        });

        // 初始化datagrid
        $.getJSON("/IFView/IndexHandler.ashx?action=GetTableData&yjlxbm=00&page=1&&rows=200", function (data) {

            var dataArr = new Array();
            dataArr = data.rows;
            $(".ui-loading").loading();
            var dataJson = { "total": data.total, "rows": dataArr };
            $gridDiv.datagrid("loadData", dataJson);
            $(".ui-loading").fadeOut();
        });



        // 事件的绑定

        $(document).delegate("#btnEffect", "click", function () {
            $(".gridBodyClsWithTitle")
            .add($(".gridTitleCls"));
            $("body").toggleClass("showExpand");
        });

        $(document).delegate("#ycyy","click", function () {
            var selectedRow = $gridDiv.datagrid('getSelected');
            if (!selectedRow) { // 没有选择行

                $.messager.alert('警告', '必须选择一行数据后，才.ycyyBtnSelect能进行操作！', 'info');
                return false;
            }

            $ycTableDialog.dialog("open");
        });

        var dialogClose = function () {
            main.ycyyAddData = {}; //清空 新增的数据
            $("#yjlxTableDataGrid").edatagrid("reload");
        };
        // 事件的绑定  关闭
        $(document).delegate("#closeDialog", "click", function () {
            $("#ycyyInputTable").dialog("close"); //面板 关闭
            dialogClose();
        });


        $(document).delegate(".ycyyBtnSelect", "click", function (e) {

            $("#ycyySelectList").dialog("open");
        });

        $("#ycyyInputTable").delegate(
    ".datagrid-row-selected input[name='beizhu']",
    "change",
    function (e) {
        main.ycyyAddData.beizhu = $(this).val();
    }
    );



    $(document).delegate("#saveData", "click", function (e) {
        var selectedRow = $("#yjlxTableDataGrid").edatagrid('getSelected');
        if (!selectedRow) { // 没有选择行

            $.messager.alert('警告', '必须新增后才能保存！', 'info');
            return false;
        }
        if (!selectedRow.isNewRecord) { // 没有选择行
            return false;

        }
        if (!main.ycyyAddData || !main.ycyyAddData.ycyymc) {
            $.messager.alert(
            "提醒",
            "必须选择异常原因后，才能进行保存操作",
            "alert"
            );
            return false;
        }



        if (!main.ycyyAddData) {
            $.messager.alert(
            "警告",
            "必须传相应的数据参数才能进行保存操作",
            "alert"
            );
            return false;
        }

        var json = main.ycyyAddData;
        var oneItem = {};
        if (json.id) {
            //如果id 存在
            oneItem = {
                action: "SaveYcyy",
                json: JSON.stringify(json),
                id: json.id
            };
        } else {
            oneItem = {
                action: "SaveYcyy",
                json: JSON.stringify(json)
            };
        }
        //console.log(oneItem); debugger
        //loading

        var Params = oneItem; // 请求参数
        var Handler = function (data) {
            // 处理函数
            if (data.result) {
                $.messager.alert("提示信息", data.msg, "info");
            } else {
                $.messager.alert("提示信息", "保存失败，查找后台相关原因", "info");
            }

            $("#ycyySelectList").dialog("close"); //面板 关闭
            $("#yjlxTableDataGrid").edatagrid("disableEditing");
            $("#yjlxTableDataGrid").edatagrid("options").editIndex = -1;
            $.getJSON("/IFView/IndexHandler.ashx?action=GetYcyyTableData&yjlxbh=" + main.ycyyAddData.yjlxbm + "&ywbh=" + main.ycyyAddData.ywbh, function (data) {
                if (data.rows && data.rows.length) {

                    var dataArr = new Array();
                    dataArr = data.rows;
                    var dataJson = { "total": data.total, "rows": dataArr };
                    $("#yjlxTableDataGrid").edatagrid("loadData", dataJson);
                }

            });

        };

        ajaxPost(baseUrl, Params, Handler);
    });


        // 事件的绑定  新增
        $(document).delegate("#addRow", "click", function (e) {
            if ($("#yjlxTableDataGrid").edatagrid("options").editing) {
                $.messager.alert("提醒", "保存后再操作", "alert");
            }
            var selectRow = $gridDiv.edatagrid("getSelected");
          
            var zbrTime = getTime();
            $(".editCell")
            .eq(1)
            .val(zbrTime)
            .addClass("zbDateInput")
            .attr({ readonly: true });
            main.ycyyAddData.zbr = $.trim($(window.top.document.getElementById("userName")).text());
            $(".editCell")
            .eq(0)
            .text(main.ycyyAddData.zbr);
            main.ycyyAddData.zbrq = zbrTime;
            main.ycyyAddData.isNew = true;
            main.ycyyAddData.ycyyqcsj = "";
            main.ycyyAddData.ycyymc = "";
            main.ycyyAddData.ycyyqc = "N";
            main.ycyyAddData.ywbh = selectRow.ywbh;
            main.ycyyAddData.yjlxbm = selectRow.yjlxbm;
            main.ycyyAddData.wxsffs = "N";
            main.ycyyAddData.beizhu = "";
            $("#yjlxTableDataGrid").edatagrid("addRow")
            .edatagrid("updateRow", {
                index: $("#yjlxTableDataGrid").edatagrid("options").editIndex,
                row: main.ycyyAddData
            });
        });

        $(document).delegate("#filterFunc", "click", function () {

            $(".ui-loading").loading();
            var paras = {};
            $.each($("#ohForm").serializeArray(), function (i, item) {
                paras[item.name] = item.value;
            });

            var ywbh = paras["ywbh"] ? paras["ywbh"] : "";
            var yjnr = paras["yjnr"] ? paras["yjnr"] : "";
            var ry = paras["ry"] ? paras["ry"] : "";
            if (paras["jdrjc"] == "全部") {
                var jdrjc = "";
            } else {
                var jdrjc = paras["jdrjc"] ? paras["jdrjc"] : "";
            }
            var sfgx = paras["sfgx"] ? paras["sfgx"] : "";

            var yjlxbm = $(".activeMenuListTitle").attr("data-id");

            if ($(".activeTheLastItem").attr("data-id")) {
                yjlxbm = $(".activeTheLastItem").attr("data-id");
            }
            $.getJSON("/IFView/IndexHandler.ashx?action=GetTableData&yjlxbm=" + yjlxbm + "&page=1&rows=200&ywbh=" + ywbh + "&yjnr=" + yjnr + "&ry=" + ry + "&jdrjc=" + jdrjc + "&sfgx=" + sfgx, function (data) {
                var dataArr = new Array();
                dataArr = data.rows;
                var dataJson = { "total": data.total, "rows": dataArr };
                $gridDiv.datagrid("loadData", dataJson);
                $(".ui-loading").hide();
            });
     });



 </script>



  </body>
</html>

